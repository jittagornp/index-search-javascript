<html>
    <head>
        <style>
            .highlighter{
                color : red;
            }

            .level-0 > a{
                font-weight: bold; 
            }
        </style>
    </head>
    <body>
        <script src="jquery.js"></script>
        <script src="repository.js"></script>
        <script src="additionalDictionaries.js"></script>
        <script src="indexsearch.js"></script>
        <script>
            (function($, repository) {
                $(function() {
                    //==========================================================
                    var indexSearch__ = new IndexSearch({
                        repository: repository, //require
                        indexOnFields: ['name'], //require
                        maximumIndexKeySize: 5,
                        additionalDictionaries: additionalDictionaries
                    });
                    //==========================================================

                    var $inputSearch = $('#inputSearch');
                    var $summary = $('#summary');
                    var $suggestions = $('#suggestions');
                    var $repositories = $('#repositories');

                    showResult(repository);
                    $inputSearch.keyup(function() {
                        var keyword = $inputSearch.val();
                        var result = indexSearch__.search(keyword);
                        if (result.getTotalPosition() !== 0) {
                            $summary.text('search : \'' + indexSearch__.getKeyword() + '\' found ' + result.getTotalPosition() + ' positions on ' + result.getTotalSentence() + ' sentences.');
                        }else{
                            $summary.text('');
                        }
                        
                        if(result.getSuggestions().length !== 0){
                            $suggestions.text('suggestions : ' + result.getSuggestions());
                        }else{
                            $suggestions.text('');
                        }
                        
                        showResult(result.getContent());
                    });

                    function showResult(result) {
                        var $parentDOM = $('<ul>');
                        $repositories.html($parentDOM);
                        walkRepositoryShowResult(result, $parentDOM);
                    }

                    function walkRepositoryShowResult(node, $parentDOM) {
                        var nodes = node.nodes;
                        if (!nodes || nodes.length === 0) {
                            return;
                        }

                        for (var index in nodes) {
                            var nd = nodes[index];
                            var $link = $('<a>').attr('href', nd.link).html(nd.nameHighlight || nd.name);
                            var $childDOM = $('<ol>');
                            var $list = $('<li>').attr('class', nd.level).append($link).append($childDOM);
                            $parentDOM.append($list);

                            walkRepositoryShowResult(nd, $childDOM);
                        }
                    }
                });
            })(jQuery, node);
        </script>

        <input id="inputSearch"/>
        <div id="result">
            <div id="summary"></div>
            <div id="suggestions"></div>
            <div id="repositories"></div>
        </div>
    </body>
</html>